<div class="service-detail-page" *ngIf="!loading && service">
  <!-- Header -->
  <div class="page-header">
    <button class="back-btn" (click)="goBack()">
      <span class="material-icons">arrow_back</span>
      Back to Results
    </button>
    <div class="logo">UrbanFix</div>
  </div>

  <div class="content-container">
    <!-- Left Column -->
    <div class="left-column">
      <!-- Service Image -->
      <div class="service-image-container">
        <img
          [src]="getServiceImage()"
          [alt]="service.title"
          class="service-image"
        />
        <span class="discount-badge" *ngIf="hasDiscount()">
          {{ getSavingsPercentage() }}% OFF
        </span>
        <span class="category-badge">Cleaning</span>
      </div>

      <!-- Service Title and Rating -->
      <div class="service-header">
        <h1 class="service-title">{{ service.title }}</h1>
        <div class="rating-summary">
          <span class="star">⭐</span>
          <span class="rating-value">{{ averageRating.toFixed(1) }}</span>
          <span class="rating-count">({{ totalReviews }} reviews)</span>
          <span class="duration">
            <span class="material-icons">schedule</span>
            {{ getDurationText() }}
          </span>
        </div>
      </div>

      <!-- About Section -->
      <div class="section">
        <h2 class="section-title">About this service</h2>
        <p class="service-description" *ngIf="service.description">
          {{ service.description }}
        </p>
        <p class="service-description" *ngIf="!service.description">
          Professional deep home cleaning service that covers all areas of your
          home. Our trained professionals use eco-friendly cleaning products and
          advanced equipment to ensure a spotless and hygienic living space.
          Perfect for regular maintenance or special occasions.
        </p>
      </div>

      <!-- What's Included -->
      <div class="section">
        <h3 class="subsection-title">What's Included</h3>
        <ul class="included-list">
          <li>
            <span class="check-icon">✓</span> Complete dusting of all surfaces
          </li>
          <li><span class="check-icon">✓</span> Floor vacuuming and mopping</li>
          <li>
            <span class="check-icon">✓</span> Kitchen deep cleaning and
            sanitization
          </li>
          <li>
            <span class="check-icon">✓</span> Bathroom cleaning and disinfection
          </li>
          <li><span class="check-icon">✓</span> Window and glass cleaning</li>
          <li>
            <span class="check-icon">✓</span> Furniture and upholstery dusting
          </li>
        </ul>
      </div>

      <!-- Service Features -->
      <div class="features-grid">
        <div class="feature-item">
          <span class="material-icons feature-icon">verified_user</span>
          <div class="feature-text">
            <strong>Verified & trusted professionals</strong>
          </div>
        </div>
        <div class="feature-item">
          <span class="material-icons feature-icon">workspace_premium</span>
          <div class="feature-text">
            <strong>Satisfaction guaranteed</strong>
          </div>
        </div>
        <div class="feature-item">
          <span class="material-icons feature-icon">support_agent</span>
          <div class="feature-text">
            <strong>On-site service</strong>
          </div>
        </div>
        <div class="feature-item">
          <span class="material-icons feature-icon">event_available</span>
          <div class="feature-text">
            <strong>3-4 months of car booking</strong>
          </div>
        </div>
      </div>

      <!-- Customer Reviews -->
      <div class="section reviews-section">
        <h2 class="section-title">Customer Reviews</h2>

        <!-- Rating Overview -->
        <div class="rating-overview">
          <div class="rating-score">
            <div class="score-number">{{ averageRating.toFixed(1) }}</div>
            <div class="stars">
              <span
                *ngFor="let filled of getStarArray(averageRating)"
                class="star"
              >
                {{ filled ? '⭐' : '☆' }}
              </span>
            </div>
            <div class="total-reviews">{{ totalReviews }} reviews</div>
          </div>

          <div class="rating-bars">
            <div class="rating-bar" *ngFor="let dist of ratingDistribution">
              <span class="bar-label">{{ dist.stars }} ★</span>
              <div class="bar-container">
                <div class="bar-fill" [style.width.%]="dist.percentage"></div>
              </div>
              <span class="bar-count">{{ dist.count }}</span>
            </div>
          </div>
        </div>

        <!-- Individual Reviews -->
        <div class="reviews-list">
          <div class="review-item" *ngFor="let review of service.ratings">
            <div class="review-header">
              <div class="reviewer-avatar">
                {{ review.userId.charAt(0).toUpperCase() }}
              </div>
              <div class="reviewer-info">
                <div class="reviewer-name">
                  User {{ review.userId.substring(0, 3) }}
                </div>
                <div class="review-date" *ngIf="review.createdAt">
                  {{ formatDate(review.createdAt) }}
                </div>
              </div>
              <div class="review-rating">
                <span
                  *ngFor="let filled of getStarArray(review.rating)"
                  class="star-small"
                >
                  {{ filled ? '⭐' : '☆' }}
                </span>
              </div>
            </div>
            <p class="review-comment">{{ review.comment }}</p>
            <div class="review-helpful">
              Helpful ({{ getRandomHelpfulCount() }})
            </div>
          </div>
        </div>

        <button class="view-all-reviews-btn" *ngIf="totalReviews > 4">
          View All {{ totalReviews }} Reviews
        </button>
      </div>
    </div>

    <!-- Right Column - Booking Card -->
    <div class="right-column">
      <div class="booking-card">
        <div class="price-section">
          <div class="original-price" *ngIf="hasDiscount()">
            ₹{{ getOriginalPrice() }}
          </div>
          <div class="final-price">₹{{ getFinalPrice() }}</div>
          <div class="savings" *ngIf="hasDiscount()">
            Save ₹{{ getSavingsAmount() }} ({{ getSavingsPercentage() }}% off)
          </div>
        </div>

        <button class="book-now-btn" (click)="bookNow()">Book Now</button>

        <div class="booking-features">
          <div class="booking-feature">
            <span class="material-icons">verified</span>
            <span>100% Safe & Secure Payment</span>
          </div>
          <div class="booking-feature">
            <span class="material-icons">local_shipping</span>
            <span>Flexible Rescheduling</span>
          </div>
          <div class="booking-feature">
            <span class="material-icons">thumb_up</span>
            <span>Satisfaction Guaranteed</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <p>Loading service details...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="!loading && !service">
  <span class="material-icons error-icon">error_outline</span>
  <h2>Service Not Found</h2>
  <p>The service you're looking for doesn't exist or has been removed.</p>
  <button class="back-btn-error" (click)="goBack()">Back to Services</button>
</div>
